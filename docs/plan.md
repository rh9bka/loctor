# Документация по архитектуре проекта "Доска объявлений"

## Общая структура

Проект построен на Yii2 Advanced Template и разделён на четыре основных слоя:
- **Админка (Backend, Yii2)** — управление системой, пользователями, объявлениями и модерацией.
- **API (Yii2)** — REST API для мобильных и веб-клиентов.
- **Сайт для пользователей (Frontend, React — планируется)** — SPA для конечных пользователей.
- **Мобильное приложение (React Native — планируется)** — клиент для iOS/Android.

---

## 1. Backend (Админка, Yii2)

**Назначение:**  
Обеспечивает административный интерфейс для управления пользователями, объявлениями, категориями, модерацией, аналитикой.

**Ключевые компоненты:**
- Модели: User, Ad, Category, AdImage, AdLog, Favorite.
- Контроллеры: UserController, AdController, SiteController.
- Представления: CRUD-интерфейсы, формы, фильтры.
- Логирование и аудит действий.
- Поиск и фильтрация (AdSearch, UserSearch).

---

## 2. API (Yii2)

**Назначение:**  
REST-интерфейс для обмена данными между backend и внешними клиентами (SPA, мобильное приложение).

**Структура:**
- Версионирование: модуль v1 (`api/modules/v1`).
- Базовый контроллер с CORS и Bearer-авторизацией.
- Контроллеры:
  - `AdsController` — работа с объявлениями (CRUD, избранное, фильтрация, пагинация).
  - `AuthController` — регистрация, аутентификация, восстановление пароля, SMS.
  - `CategoriesController` — дерево категорий, просмотр.
- Модели: Ad, User, Category, Favorite.
- Обработка файлов: загрузка изображений объявлений.
- Планы по расширению: комментарии, модерация, уведомления, профиль пользователя, аналитика, теги.

**Текущее покрытие по коду:**
- [x] Базовая структура API (модули, пространства имён, CORS, Bearer-авторизация)
- [x] Версионирование API (модуль v1)
- [x] Контроллеры: AdsController, AuthController, CategoriesController
- [x] Обработка файлов (загрузка изображений объявлений)
- [x] Поиск и фильтрация объявлений
- [x] Пагинация, сортировка объявлений
- [ ] Документация API (Swagger/OpenAPI)
- [ ] Расширенный CRUD для категорий
- [ ] Кэширование
- [ ] Тестирование API

**Сущности API:**
- [x] Объявления (Ads)
- [x] Пользователи (Users)
- [x] Категории (Categories)
- [x] Избранное (Favorite)
- [ ] Комментарии к объявлениям
- [ ] Модерация и жалобы
- [ ] Расширенное API для файлов/изображений
- [ ] Профиль пользователя (просмотр/редактирование)
- [ ] Уведомления
- [ ] Администрирование через API
- [ ] Аналитика/статистика
- [ ] Теги/атрибуты объявлений
- [ ] История/логи действий

---

## 3. Frontend (React, планируется)

**Назначение:**  
Современный SPA для пользователей, реализованный на React, взаимодействующий с API.

**Возможности:**
- Регистрация, авторизация, восстановление пароля.
- Просмотр, создание и редактирование объявлений.
- Работа с избранным, фильтрация, поиск.
- Личный кабинет, уведомления.
- Адаптивный дизайн.

**Текущее состояние:**  
Пока реализовано на Yii2 + Bootstrap 5 (MVC, server-side rendering).

### Шаги реализации frontend на React

1. **Инициализация проекта и базовая структура**
   - [x] Выбран инструмент Next.js 13+ (app router).
   - [x] Структура директорий: `/app`, `/components`, `/api`, `/types`.
   - [x] Используется TypeScript.
   - [x] Линтеры и форматтеры настроены (eslint, prettier).

2. **Базовый роутинг и шаблон приложения**
   - [x] Используется Next.js router (app router).
   - [x] Созданы страницы: Главная (`/app/page.tsx`), Вход (`/app/login/page.tsx`), Регистрация (`/app/register/page.tsx`), Личный кабинет (`/app/profile/page.tsx`), 404 (`/app/not-found.tsx`).
   - [x] Реализован SSR layout (`/app/layout.tsx`) с header, footer, контейнером.

3. **UI-компоненты и дизайн**
   - [x] Собственные компоненты: Button, AdCard.
   - [x] Стилизация через CSS.
   - [x] Интерфейс адаптивен для базовых сценариев.

4. **Аутентификация и авторизация**
   - [ ] Форма входа есть, но нет полноценной логики авторизации (нет работы с API, токенами, защищёнными роутами).
   - [ ] Регистрация и восстановление пароля — только заготовки.

5. **Работа с объявлениями (Ads)**
   - [x] Получение и отображение списка объявлений с пагинацией и фильтрацией (`/app/ads/page.tsx`).
   - [x] Просмотр отдельного объявления (`/app/ads/[id]/page.tsx`).
   - [ ] Создание и редактирование объявления отсутствуют.
   - [ ] Загрузка изображений отсутствует.
   - [x] Интеграция с API (fetchAds, fetchAdById, параметры page/per-page, debugPanel).

6. **Работа с избранным**
   - [x] API для избранного реализован (favorite.ts, types/favorite.ts).
   - [ ] UI для избранного не выведен на отдельную страницу/раздел.

7. **Структурирование кода для переиспользования**
   - [x] Все типы вынесены в `/types`.
   - [x] Вся бизнес-логика API вынесена в `/api`.
   - [x] Структура ответов API унифицирована.

8. **Тестирование и отладка**
   - [x] Добавлен debugPanel для всех API-запросов.
   - [ ] Нет unit/e2e тестов компонентов.

9. **Документация и поддержка**
   - [x] Архитектура и структура фронта описаны в `plan.md`.
   - [ ] Нет отдельной документации по компонентам и API.

10. **Деплой и поддержка**
    - [ ] Не настроен деплой (Vercel/Netlify/Docker).
    - [ ] Нет итоговой документации по сборке/развёртыванию.

**Важно:**
- Каждый шаг реализуется итеративно, с тестированием и ревью.
- Архитектура должна обеспечивать масштабируемость и поддержку новых фич.
- UI/UX — отдельное внимание: удобство, адаптивность, скорость.

---

## 4. Мобильное приложение (React Native, планируется)

**Назначение:**  
Мобильный клиент для iOS/Android, использующий API.

**Планируемые возможности:**
- Регистрация, авторизация.
- Работа с объявлениями (просмотр, создание, избранное).
- Push-уведомления, работа с камерой, геолокация.

---

## Вспомогательные компоненты и задачи

- CI/CD, автоматизация тестирования и деплоя (планируется).
- Документация API (Swagger/OpenAPI — планируется).
- Оптимизация производительности и безопасность.
- Развёртывание через Docker/Vagrant.

---

## Взаимодействие компонентов

- Backend и API используют общие модели (common/models).
- Frontend и мобильное приложение работают только через API.
- Авторизация реализована через JWT/Bearer-токены.
- Все файлы и изображения объявлений хранятся централизованно и доступны через API.